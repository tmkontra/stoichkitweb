<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="author" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Load React. -->
    <!-- Note: when deploying, replace "development.js" with "production.min.js". -->
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <link href="css/style.css" rel="stylesheet">
</head>

<body>


<script src="js/script.js"></script>
<script>
    'use strict';

    const e = React.createElement;

    class ReactionForm extends React.Component {
        newReagent = () => {
            return {
                formula: "",
                mass: null,
                coeff: 1,
            }
        };

        constructor(props) {
            super(props);
            this.state = {
                reagents: [this.newReagent()],
                product: this.newReagent(),
                yield: null,
            };
        }

        inputClass = "form-control";

        rglist = () => {
            var inputs = this.state.reagents.map((rg, i) => {
                const updateFormula = (event) => {
                  let reagents = [...this.state.reagents];
                  reagents[i].formula = event.target.value;
                  this.setState({
                      ...this.state,
                      reagents: reagents
                  })
                };
                const updateMass = (event) => {
                    let reagents = [...this.state.reagents];
                    reagents[i].mass = Number(event.target.value);
                    this.setState({
                        ...this.state,
                        reagents: reagents
                    })
                };
                const updateCoeff = (event) => {
                    let reagents = [...this.state.reagents];
                    reagents[i].coeff = Number(event.target.value);
                    this.setState({
                        ...this.state,
                        reagents: reagents
                    })
                };
                return [
                    e("div", {className: "d-flex form-group"},
                        e("input", {type: "number", style: {maxWidth: "4rem"}, className: this.inputClass, value: this.state.reagents[i].coeff, onChange: updateCoeff, placeholder: "1"}),
                        e("p", {className: "mr-2 ml-2",}, "∗"),
                        e("input", { required: true, type: "text", style: {maxWidth: "12rem"}, className: this.inputClass, value: this.state.reagents[i].formula, onChange: updateFormula, placeholder: "formula" }),
                        e("p", {className: "mr-2 ml-2"}, "×"),
                        e("input", {type: "number", style: {maxWidth: "8rem"}, className: this.inputClass, value: this.state.reagents[i].mass, onChange: updateMass, placeholder: "amount (g)"}),
                    )
                ]
            });
            return e(
                "div",
                {className: "mb-4"},
                ...inputs
            )
        };

        p = () => {
            const updateFormula = (event) => {
                var product = this.state.product;
                this.setState({
                    ...this.state,
                    product: {
                        ...product,
                        formula: event.target.value
                    }
                })
            };
            const updateMass = (event) => {
                var product = this.state.product;
                this.setState({
                    ...this.state,
                    product: {
                        ...product,
                        mass: Number(event.target.value)
                    }
                })
            };
            const updateCoeff = (event) => {
                var product = this.state.product;
                this.setState({
                    ...this.state,
                    product: {
                        ...product,
                        coeff: Number(event.target.value)
                    }
                })
            };
            return e(
                "div",
                {className: "mb-4"},
                e("div", {className: "d-flex flex-row form-group"},
                    e("input", {type: "number", style: {maxWidth: "4rem"}, className: this.inputClass,value: this.state.product.coeff, onChange: updateCoeff, placeholder: "1"}),
                    e("p", {className: "mr-2 ml-2"}, "∗"),
                    e("input", {type: "text", style: {maxWidth: "12rem"}, className: this.inputClass, value: this.state.product.formula, onChange: updateFormula, placeholder: "formula" }),
                    e("p", {className: "mr-2 ml-2"}, "×"),
                    e("input", {type: "number", style: {maxWidth: "8rem"}, className: this.inputClass, value: this.state.product.mass, onChange: updateMass, placeholder: "amount (g)"}),
                )
            )
        };

        addReagent = (ev) => {
            ev.preventDefault();
            this.setState({
                reagents: [
                    ...this.state.reagents,
                    this.newReagent()
                ]
            })
        };

        removeReagent = (ev) => {
            ev.preventDefault();
            if (this.state.reagents.length > 1){
                this.setState({
                    reagents: this.state.reagents.slice(0, -1)
                })
            }
        };

        onSubmit = (ev) => {

            if(!ev.defaultPrevented){
                ev.preventDefault();
                const URL = "http://localhost:3030/yield";
                fetch(
                    URL,
                    {
                        mode: 'cors',
                        method: "POST",
                        headers: {
                            'Content-Type': 'application/json',
                            'Origin': 'localhost'
                        },
                        body: JSON.stringify(this.state)
                    }
                )
                    .then(res => res.text())
                    .then(
                        (result) => {
                            this.setState({
                                yield: result
                            });
                        },
                    )
            }
        };

        render() {
            let yieldDisplay;
            if (this.state.yield) {
                yieldDisplay = [e("h4", {className: "mt-4"}, e("p", {}, "Yield:"), e("p", {}, `${this.state.yield}`))];
            } else {
                yieldDisplay = []
            }

            return e(
                'form',
                {id: "reaction-form"},
                e("div", {className: "d-flex flex-row"},
                    e("div", {},
                        this.rglist(),
                        e("div", {className: "d-flex flex-row justify-content-between"},
                            e("button", {className: "btn btn-secondary", onClick: this.addReagent}, "Add a Reagent"),
                            e("button", {className: "btn btn-danger", onClick: this.removeReagent}, "Remove a Reagent")
                        )
                    ),
                    e("p", {className: "mr-2 ml-2"}, "="),
                    e("div", {},
                        this.p(),
                        e("button", {className: "btn btn-primary", onClick: this.onSubmit}, "Submit"),
                    )
                ),
                ...yieldDisplay
            );
        }
    }

    const domContainer = document.querySelector('#reaction-form-container');
    ReactDOM.render(e(ReactionForm), domContainer);
</script>
</body>


</html>
